var c=class{withFields(e){let n=Object.keys(this).map(l=>l in e?e[l]:this[l]);return new this.constructor(...n)}},m=class{static fromArray(e,n){let l=n||new p;return e.reduceRight((a,s)=>new y(s,a),l)}[Symbol.iterator](){return new L(this)}toArray(){return[...this]}atLeastLength(e){for(let n of this){if(e<=0)return!0;e--}return e<=0}hasLength(e){for(let n of this){if(e<=0)return!1;e--}return e===0}countLength(){let e=0;for(let n of this)e++;return e}};var L=class{#e;constructor(e){this.#e=e}next(){if(this.#e instanceof p)return{done:!0};{let{head:e,tail:n}=this.#e;return this.#e=n,{value:e,done:!1}}}},p=class extends m{},y=class extends m{constructor(e,n){super(),this.head=e,this.tail=n}};var w=class t extends c{static isResult(e){return e instanceof t}},f=class extends w{constructor(e){super(),this[0]=e}isOk(){return!0}},o=class extends w{constructor(e){super(),this[0]=e}isOk(){return!1}};function _(t,e,n,l,a,s){let r=new globalThis.Error(a);r.gleam_error=t,r.module=e,r.line=n,r.fn=l;for(let i in s)r[i]=s[i];return r}var Et=new DataView(new ArrayBuffer(8));var J=5,v=Math.pow(2,J),zt=v-1,It=v/2,jt=v/4;function N(t,e){if(t.isOk()){let n=t[0];return new f(e(n))}else{if(t.isOk())throw _("case_no_match","gleam/result",67,"map","No case clause matched",{values:[t]});{let n=t[0];return new o(n)}}}function h(t,e,n,l){if(e?.tag&&t?.nodeType===1){let a=e.tag.toUpperCase(),s=e.namespace||"http://www.w3.org/1999/xhtml";return t.nodeName===a&&t.namespaceURI==s?K(t,e,n,l):M(t,e,n,l)}return e?.tag?M(t,e,n,l):typeof e?.content=="string"?t?.nodeType===3?Z(t,e):X(t,e):document.createComment(["[internal lustre error] I couldn't work out how to render this element. This","function should only be called internally by lustre's runtime: if you think","this is an error, please open an issue at","https://github.com/hayleigh-dot-dev/gleam-lustre/issues/new"].join(" "))}function M(t,e,n,l=null){let a=e.namespace?document.createElementNS(e.namespace,e.tag):document.createElement(e.tag);a.$lustre={__registered_events:new Set};let s="";for(let r of e.attrs)r[0]==="class"?x(a,r[0],`${a.className} ${r[1]}`):r[0]==="style"?x(a,r[0],`${a.style.cssText} ${r[1]}`):r[0]==="dangerous-unescaped-html"?s+=r[1]:r[0]!==""&&x(a,r[0],r[1],n);if(customElements.get(e.tag))a._slot=e.children;else if(e.tag==="slot"){let r=new p,i=l;for(;i;)if(i._slot){r=i._slot;break}else i=i.parentNode;for(let u of r)a.appendChild(h(null,u,n,a))}else if(s)a.innerHTML=s;else for(let r of e.children)a.appendChild(h(null,r,n,a));return t&&t.replaceWith(a),a}function K(t,e,n,l){let a=t.attributes,s=new Map;t.$lustre??={__registered_events:new Set};for(let r of e.attrs)r[0]==="class"&&s.has("class")?s.set(r[0],`${s.get("class")} ${r[1]}`):r[0]==="style"&&s.has("style")?s.set(r[0],`${s.get("style")} ${r[1]}`):r[0]==="dangerous-unescaped-html"&&s.has("dangerous-unescaped-html")?s.set(r[0],`${s.get("dangerous-unescaped-html")} ${r[1]}`):r[0]!==""&&s.set(r[0],r[1]);for(let{name:r,value:i}of a)if(!s.has(r))t.removeAttribute(r);else{let u=s.get(r);u!==i&&(x(t,r,u,n),s.delete(r))}for(let r of t.$lustre.__registered_events)if(!s.has(r)){let i=r.slice(2).toLowerCase();t.removeEventListener(i,t.$lustre[`${r}Handler`]),t.$lustre.__registered_events.delete(r),delete t.$lustre[r],delete t.$lustre[`${r}Handler`]}for(let[r,i]of s)x(t,r,i,n);if(customElements.get(e.tag))t._slot=e.children;else if(e.tag==="slot"){let r=t.firstChild,i=new p,u=l;for(;u;)if(u._slot){i=u._slot;break}else u=u.parentNode;for(;r;)Array.isArray(i)&&i.length?h(r,i.shift(),n,t):i.head&&(h(r,i.head,n,t),i=i.tail),r=r.nextSibling;for(let B of i)t.appendChild(h(null,B,n,t))}else if(s.has("dangerous-unescaped-html"))t.innerHTML=s.get("dangerous-unescaped-html");else{let r=t.firstChild,i=e.children;for(;r;)if(Array.isArray(i)&&i.length){let u=r.nextSibling;h(r,i.shift(),n,t),r=u}else if(i.head){let u=r.nextSibling;h(r,i.head,n,t),i=i.tail,r=u}else{let u=r.nextSibling;r.remove(),r=u}for(let u of i)t.appendChild(h(null,u,n,t))}return t}function x(t,e,n,l){switch(typeof n){case(e.startsWith("data-server-")&&"string"):{let a=e.slice(12).toLowerCase(),s=r=>{let i=r.target.dataset.data||"{}";l({tag:n,data:JSON.parse(i)})};t.$lustre[`${e}Handler`]&&t.removeEventListener(a,t.$lustre[`${e}Handler`]),t.addEventListener(a,s),t.$lustre[e]=n,t.$lustre[`${e}Handler`]=s,t.$lustre.__registered_events.add(e);break}case"string":t.getAttribute(e)!==n&&t.setAttribute(e,n),n===""&&t.removeAttribute(e),e==="value"&&t.value!==n&&(t.value=n);break;case(e.startsWith("on")&&"function"):{if(t.$lustre[e]===n)break;let a=e.slice(2).toLowerCase(),s=r=>N(n(r),l);t.$lustre[`${e}Handler`]&&t.removeEventListener(a,t.$lustre[`${e}Handler`]),t.addEventListener(a,s),t.$lustre[e]=n,t.$lustre[`${e}Handler`]=s,t.$lustre.__registered_events.add(e);break}default:t[e]=n}}function X(t,e){let n=document.createTextNode(e.content);return t&&t.replaceWith(n),n}function Z(t,e){let n=t.nodeValue,l=e.content;return l?(n!==l&&(t.nodeValue=l),t):(t?.remove(),null)}var O=class extends HTMLElement{static get observedAttributes(){return["route"]}#e=null;#t=null;constructor(){super()}connectedCallback(){this.#e=document.createElement("div"),this.appendChild(this.#e)}attributeChangedCallback(e,n,l){switch(e){case"route":l?n!==l&&(this.#t?.close(),this.#t=new WebSocket(`ws://${window.location.host}${l}`),this.#t.addEventListener("message",({data:a})=>{let s=JSON.parse(a);switch(s.$){case"Patch":{this.patch(s.vdom);break}}})):(this.#t?.close(),this.#t=null)}}patch(e){let n=({tag:l,data:a})=>this.#t?.send(JSON.stringify({$:"Event",tag:l,event:{data:a}}));this.#e=h(this.#e,e,n)}disconnectedCallback(){this.#t?.close()}};customElements.define("lustre-server-component",O);export{O as LustreServerComponent};
